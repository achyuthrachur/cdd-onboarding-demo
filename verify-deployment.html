<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deployment Verification Tool</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      color: #011E41;
      margin-bottom: 10px;
    }
    .status {
      padding: 15px;
      margin: 20px 0;
      border-radius: 8px;
      font-weight: 500;
    }
    .pending { background: #FFF3CD; border-left: 4px solid #F5A800; }
    .success { background: #D1F2EB; border-left: 4px solid #05AB8C; }
    .error { background: #F8D7DA; border-left: 4px solid #E5376B; }
    button {
      background: #F5A800;
      color: #011E41;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 10px 10px 0;
    }
    button:hover {
      background: #D7761D;
    }
    .url-input {
      width: 100%;
      padding: 10px;
      border: 2px solid #E0E0E0;
      border-radius: 6px;
      font-size: 14px;
      margin: 10px 0;
    }
    .checks {
      margin-top: 20px;
    }
    .check-item {
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      background: #f8f9fa;
    }
    .check-item.pass { background: #D1F2EB; color: #0C7876; }
    .check-item.fail { background: #F8D7DA; color: #992A5C; }
    code {
      background: #011E41;
      color: #F5A800;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç CDD Deployment Verification</h1>
    <p>Use this tool to check if your latest changes are deployed and visible.</p>

    <div id="status" class="status pending">
      ‚è≥ Ready to check deployment...
    </div>

    <label for="deploymentUrl"><strong>Enter your deployment URL:</strong></label>
    <input
      type="text"
      id="deploymentUrl"
      class="url-input"
      placeholder="https://your-app.vercel.app"
      value=""
    >

    <button onclick="checkDeployment()">üöÄ Check Deployment</button>
    <button onclick="hardRefresh()">üîÑ Hard Refresh Page</button>
    <button onclick="clearAllCache()">üóëÔ∏è Clear All Cache</button>

    <div id="checks" class="checks"></div>

    <hr style="margin: 30px 0; border: none; border-top: 2px solid #E0E0E0;">

    <h3>Quick Fixes:</h3>
    <ol>
      <li><strong>Hard Refresh:</strong> Press <code>Ctrl+Shift+R</code> (or <code>Cmd+Shift+R</code> on Mac)</li>
      <li><strong>Clear Cache:</strong> Open DevTools (F12) ‚Üí Right-click refresh ‚Üí "Empty Cache and Hard Reload"</li>
      <li><strong>Incognito Mode:</strong> Open your site in a private/incognito window</li>
      <li><strong>Check Build Logs:</strong> Visit <a href="https://vercel.com/dashboard" target="_blank">Vercel Dashboard</a></li>
    </ol>

    <h3>CSS Variables to Check:</h3>
    <div id="cssVars" style="margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 6px; font-family: monospace; font-size: 13px;">
      Click "Check Deployment" to see current CSS variables...
    </div>
  </div>

  <script>
    function checkDeployment() {
      const url = document.getElementById('deploymentUrl').value;
      const statusEl = document.getElementById('status');
      const checksEl = document.getElementById('checks');

      if (!url) {
        alert('Please enter your deployment URL first!');
        return;
      }

      statusEl.className = 'status pending';
      statusEl.textContent = '‚è≥ Checking deployment...';
      checksEl.innerHTML = '';

      // Check 1: CSS Variables
      checkCSSVariables();

      // Check 2: Build ID in meta tags
      checkBuildId();

      // Check 3: Fetch a resource to check headers
      fetch(url, { cache: 'no-store' })
        .then(response => {
          addCheck(
            'Cache Headers',
            response.headers.has('cache-control'),
            `Cache-Control: ${response.headers.get('cache-control') || 'Not set'}`
          );

          statusEl.className = 'status success';
          statusEl.textContent = '‚úÖ Deployment check complete!';
        })
        .catch(err => {
          statusEl.className = 'status error';
          statusEl.textContent = '‚ùå Error checking deployment: ' + err.message;
        });
    }

    function checkCSSVariables() {
      const root = document.documentElement;
      const vars = {
        '--crowe-indigo-dark': '#011E41',
        '--crowe-amber-core': '#F5A800',
        '--text-primary': window.matchMedia('(prefers-color-scheme: dark)').matches ? '#ffffff' : '#333333'
      };

      let cssVarsHtml = '<strong>Current CSS Variables:</strong><br><br>';

      for (const [varName, expectedValue] of Object.entries(vars)) {
        const actualValue = getComputedStyle(root).getPropertyValue(varName).trim();
        const match = actualValue.toLowerCase() === expectedValue.toLowerCase();

        cssVarsHtml += `${varName}: <span style="color: ${match ? '#05AB8C' : '#E5376B'}">${actualValue || 'NOT SET'}</span><br>`;

        addCheck(
          `CSS Variable: ${varName}`,
          match,
          match ? `‚úì Correct: ${actualValue}` : `‚úó Expected: ${expectedValue}, Got: ${actualValue || 'NOT SET'}`
        );
      }

      document.getElementById('cssVars').innerHTML = cssVarsHtml;
    }

    function checkBuildId() {
      const buildId = document.querySelector('meta[name="next-build-id"]');
      const hasBuildId = !!buildId;

      addCheck(
        'Build ID Present',
        hasBuildId,
        hasBuildId ? `Build ID: ${buildId?.content}` : 'No build ID found (may indicate old cached version)'
      );
    }

    function addCheck(name, passed, details) {
      const checksEl = document.getElementById('checks');
      const checkDiv = document.createElement('div');
      checkDiv.className = `check-item ${passed ? 'pass' : 'fail'}`;
      checkDiv.innerHTML = `
        <strong>${passed ? '‚úÖ' : '‚ùå'} ${name}</strong><br>
        <small>${details}</small>
      `;
      checksEl.appendChild(checkDiv);
    }

    function hardRefresh() {
      const statusEl = document.getElementById('status');
      statusEl.className = 'status pending';
      statusEl.textContent = 'üîÑ Performing hard refresh...';

      setTimeout(() => {
        window.location.reload(true);
      }, 500);
    }

    function clearAllCache() {
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => caches.delete(name));
        });
      }

      localStorage.clear();
      sessionStorage.clear();

      alert('‚úÖ Cache cleared! The page will now reload.');
      window.location.reload(true);
    }

    // Auto-populate URL if on the deployment
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('deploymentUrl').value = window.location.origin;
    });
  </script>
</body>
</html>
