# CDD Onboarding Demo - Fix Plan (2026-02-07)

## Overview

This document outlines a multi-stage fix plan for 10 identified issues across the CDD Onboarding Demo application. Issues are grouped by type and priority to enable efficient remediation.

---

## Issue Summary

| # | Issue | Type | Severity |
|---|-------|------|----------|
| 1 | Document icons invisible in light mode | Visual/CSS | Medium |
| 2 | Drop zone/action area invisible in light mode | Visual/CSS | High |
| 3 | AI-Generated Sampling Rationale card text invisible | Visual/CSS | Medium |
| 4 | Extract Attributes uses demo data instead of AI API | Functional | High |
| 5 | UI elements overlapping in results view (progress bar area) | Layout | High |
| 6 | Stats cards, progress bar, labels invisible in light mode | Visual/CSS | High |
| 7 | Publish Workbooks modal poor light mode appearance | Visual/CSS | Medium |
| 8 | Auditor "Load Demo Data" loads new workbook instead of populating existing | Functional | High |
| 9 | Data persistence not working for published workbooks | Functional | Critical |
| 10 | "Continue to Live Monitoring" button not clickable (z-index) | Layout/Interaction | Critical |

---

## Stage 1: Critical Layout & Interaction Fixes

**Priority: CRITICAL**
**Estimated Effort: 2-3 hours**

These issues block user interaction and must be fixed first.

### Issue 10: "Continue to Live Monitoring" Button Not Clickable

**Problem:** Button is visible but clicks don't register due to z-index/layering issue.

**Root Cause Investigation:**
- [ ] Inspect the button's stacking context
- [ ] Check for overlapping elements with higher z-index
- [ ] Look for invisible elements capturing pointer events

**Fix Approach:**
1. Locate the button component in the results/stage-4 page
2. Add explicit `z-index` and `position: relative` to the button container
3. Check parent containers for `overflow: hidden` or stacking context issues
4. Ensure no invisible overlays are blocking clicks
5. Add `pointer-events: none` to decorative/background elements if needed

**Files to Modify:**
- `src/app/aic/stage-4/page.tsx` (or results page component)
- Related CSS/Tailwind classes

**Verification:**
- [ ] Button is clickable in both light and dark mode
- [ ] Navigation to Live Monitoring works

---

### Issue 5: UI Elements Overlapping in Results View

**Problem:** "Back to Stage 3" text overlaps with "221 of 221 rows completed" text.

**Root Cause Investigation:**
- [ ] Check flex/grid layout of the progress bar area
- [ ] Verify proper spacing between navigation and progress elements

**Fix Approach:**
1. Restructure the layout to separate navigation from progress indicator
2. Use proper flex containers with `justify-between` or grid layout
3. Ensure each element has its own space allocation
4. Add proper margins/padding between elements

**Files to Modify:**
- Results page component
- Progress bar component

**Verification:**
- [ ] No text overlap in any viewport size
- [ ] Layout remains intact in both themes

---

## Stage 2: Light Mode Visibility Fixes (CSS)

**Priority: HIGH**
**Estimated Effort: 3-4 hours**

All these issues stem from insufficient light mode theming. Many components use light/white text colors that work on dark backgrounds but are invisible on light backgrounds.

### General Approach for All Light Mode Issues

**Pattern to Apply:**
```css
/* Instead of: */
.element {
  color: white;
}

/* Use: */
.element {
  @apply text-white dark:text-white;
  /* OR for light mode visibility: */
  @apply text-gray-800 dark:text-white;
}
```

---

### Issue 1: Document Icons Invisible in Light Mode

**Location:** Documents panel (drag-and-drop document list)

**Problem:**
- File/document icons not visible
- Drag handle (6-dot grip) icons not visible

**Fix Approach:**
1. Locate the document list component
2. Add light mode icon colors: `text-gray-600 dark:text-white/70`
3. Ensure SVG icons have proper `currentColor` fill

**Files to Modify:**
- Document list/panel component
- Icon components used in the panel

---

### Issue 2: Drop Zone / Action Area Invisible in Light Mode

**Location:** Gap Assessment drop zone

**Problem:**
- Dashed border container invisible
- Instruction text invisible
- Document chips/pills invisible

**Fix Approach:**
1. Add light mode border color: `border-gray-400 dark:border-amber-500`
2. Add light mode text color: `text-gray-700 dark:text-amber-400`
3. Style document chips for both themes

**Files to Modify:**
- Gap Assessment component
- Drop zone component

---

### Issue 3: AI-Generated Sampling Rationale Card Text Invisible

**Location:** Sampling Rationale section

**Problem:**
- Header text invisible/faint
- Subtitle text invisible
- Warning banner text low contrast

**Fix Approach:**
1. Card header: `text-gray-900 dark:text-white`
2. Subtitle: `text-gray-600 dark:text-white/70`
3. Warning banner: Ensure amber text has sufficient contrast on cream background in light mode

**Files to Modify:**
- Sampling Rationale component
- Warning/info banner component

---

### Issue 6: Stats Cards & Progress Elements Invisible in Light Mode

**Location:** Results/Stage 4 page

**Problem:**
- Stats card labels (Pass, Pass w/Obs, Fail 1, etc.) invisible
- 6th stat card (N/A) cut off/missing
- Completion Progress label invisible
- Progress bar not visible
- Row count text invisible
- Filter icon faint

**Fix Approach:**
1. Stats card labels: Use dark text on light pastel backgrounds
   ```
   Pass (green bg): text-green-800 dark:text-green-100
   Pass w/Obs (yellow bg): text-yellow-800 dark:text-yellow-100
   Fail 1 (red bg): text-red-800 dark:text-red-100
   Fail 2 (orange bg): text-orange-800 dark:text-orange-100
   Questions (blue bg): text-blue-800 dark:text-blue-100
   N/A (gray bg): text-gray-800 dark:text-gray-100
   ```
2. Fix 6th card visibility/overflow issue
3. Progress label: `text-gray-700 dark:text-white/70`
4. Progress bar: Ensure visible in both modes
5. Filter icon: `text-gray-600 dark:text-white/60`

**Files to Modify:**
- Stats cards component
- Progress bar component
- Filter controls component

---

### Issue 7: Publish Workbooks Modal Poor Light Mode Appearance

**Location:** Publish Workbooks to Auditors modal

**Problem:**
- Modal background grayish/murky (should be white)
- Subtitle text low contrast
- Card backgrounds blend poorly

**Fix Approach:**
1. Modal background: `bg-white dark:bg-slate-800`
2. Subtitle: `text-gray-600 dark:text-white/70`
3. Inner cards: `bg-gray-50 dark:bg-white/10`
4. Ensure clean white appearance in light mode

**Files to Modify:**
- Publish modal component
- Modal/dialog base styles

---

## Stage 3: Functional Fixes

**Priority: HIGH to CRITICAL**
**Estimated Effort: 4-6 hours**

These require logic changes, not just styling.

---

### Issue 4: Extract Attributes Uses Demo Data Instead of AI API

**Problem:** FLU document attribute extraction shows "Demo Mode Active" despite API key being configured.

**Root Cause Investigation:**
- [ ] Check how the extraction feature detects API key availability
- [ ] Verify the API endpoint being called
- [ ] Compare with working `/api/ai/status` endpoint

**Fix Approach:**
1. Locate the extraction API route and client-side code
2. Ensure it checks for `OPENAI_API_KEY` correctly (server-side)
3. Wire up actual OpenAI API call for extraction
4. Only fall back to demo mode if API key is truly missing or API call fails

**Files to Modify:**
- `src/app/api/ai/extract/route.ts` (or similar)
- Extraction feature component
- `src/lib/ai/client.ts` (if extraction logic needed)

**Verification:**
- [ ] With API key configured, extraction calls OpenAI
- [ ] Results come from AI, not hardcoded demo data
- [ ] Demo mode banner does not appear when API is available

---

### Issue 8: Auditor "Load Demo Data" Loads New Workbook Instead of Populating Existing

**Problem:** Button replaces the workbook instead of populating the currently loaded one.

**Root Cause Investigation:**
- [ ] Review the Load Demo Data handler in auditor workbook page
- [ ] Understand current workbook state management

**Fix Approach:**
1. Modify the handler to:
   - Get the current workbook ID/reference
   - Populate that workbook with demo testing data
   - Preserve workbook metadata (ID, assignment info, etc.)
2. Only create new workbook if none exists

**Files to Modify:**
- `src/app/auditor/workbook/page.tsx` (or similar)
- `src/lib/stage-data/store.ts`
- Demo data loading functions

**Verification:**
- [ ] Clicking "Load Demo Data" fills current workbook
- [ ] Workbook identity is preserved
- [ ] Testing data appears in the existing workbook structure

---

### Issue 9: Data Persistence Not Working for Published Workbooks

**Priority: CRITICAL**

**Problem:** After publishing workbooks in AIC portal, reloading the page loses the published state.

**Root Cause Investigation:**
- [ ] Check if publish action saves to localStorage
- [ ] Verify localStorage key structure for published state
- [ ] Check if state restoration on page load includes published status

**Fix Approach:**
1. In the publish handler:
   - Save published workbook IDs to localStorage
   - Update the stage data store with published status
   - Call `persistToLocalStorage()` after publish
2. In the page/store initialization:
   - Load published status from localStorage
   - Restore workbooks as published if previously published
3. Ensure the store's `loadFromLocalStorage()` includes publish state

**Files to Modify:**
- `src/lib/stage-data/store.ts`
- Publish workbooks handler/component
- AIC layout or page initialization

**Verification:**
- [ ] Publish workbooks in AIC portal
- [ ] Reload page
- [ ] Workbooks still show as published
- [ ] Auditor portal can still see published workbooks

---

## Testing Checklist

After all fixes are applied:

### Light Mode Testing
- [ ] Documents panel: icons and drag handles visible
- [ ] Drop zone: border, text, and chips visible
- [ ] AI Sampling Rationale: all text readable
- [ ] Stats cards: all labels readable on colored backgrounds
- [ ] Progress bar: visible and labeled
- [ ] Modals: clean white background, readable text

### Dark Mode Testing
- [ ] All above elements still work correctly in dark mode
- [ ] No regression in dark mode appearance

### Functional Testing
- [ ] Extract Attributes uses real AI API (no demo mode banner)
- [ ] Auditor "Load Demo Data" populates existing workbook
- [ ] Published workbooks persist across page reload
- [ ] "Continue to Live Monitoring" button is clickable
- [ ] Navigation between stages works

### Cross-Browser Testing
- [ ] Chrome
- [ ] Firefox
- [ ] Edge

---

## Implementation Order

1. **Stage 1** - Fix critical interaction blockers (Issues 5, 10)
2. **Stage 2** - Fix light mode visibility (Issues 1, 2, 3, 6, 7)
3. **Stage 3** - Fix functional issues (Issues 4, 8, 9)

This order ensures:
- Users can navigate the app first
- Visual polish comes next
- Deep functional fixes last (may require more debugging)

---

## Notes

- All CSS fixes should follow the Tailwind v4 layer requirement: variables in `@layer base {}`
- Use `text-gray-XXX dark:text-white/XX` pattern for theme-compatible text
- Test each fix in both light and dark mode before moving to next issue
